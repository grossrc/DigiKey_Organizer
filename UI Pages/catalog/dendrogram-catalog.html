<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Intelligent Parts Catalog</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='catalog/catalog.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='catalog/dendrogram-catalog.css') }}">
</head>
<body class="cat-body">
  <main class="cat-main">
    <div class="cat-wrap">
      <header class="catalog-hero" id="hero">
        <h1 class="page-title">Parts Catalog</h1>
      </header>

      <!-- Common high-usage categories (large cards inside styled container) -->
      <section id="common-categories" class="common-categories">
        <div class="common-inner">
          <div class="common-label">Common Categories</div>
          <div class="common-grid">
            {% for c in common_categories %}
              {% set has_parts = (c.parts or 0) > 0 and c.category_id %}
              {% if has_parts %}
                <a class="common-card" href="{{ url_for('catalog_category', category_id=c.category_id) }}" title="{{ c.title }}">
                  <div class="cc-title">{{ c.title }}</div>
                  <div class="cc-sub">{{ c.parts }} parts</div>
                </a>
              {% else %}
                <div class="common-card disabled" title="{{ c.title }}">
                  <div class="cc-title">{{ c.title }}</div>
                  <div class="cc-sub zero">0 parts</div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </section>

      <!-- Two-column layout: left = search panel, right = tree -->
      <div class="layout">
        <aside class="sidebar">
          <div class="panel">
            <div class="panel-title">Search</div>
            <label for="dendro-search" class="sr-only">Search categories</label>
            <input id="dendro-search" class="input" type="text" placeholder="Search categories..." autocomplete="off" />

            <div class="dendro-controls">
              <button id="dendro-prev" class="btn nav" title="Previous match" disabled>&larr; Prev</button>
              <span id="dendro-match-count" class="match-count">0</span>
              <button id="dendro-next" class="btn nav" title="Next match" disabled>Next &rarr;</button>
            </div>

            <button id="dendro-reset" class="btn danger block dendro-reset" title="Reset search & tree" disabled>Reset</button>

            <div class="panel-note">Tip: Use Left/Right arrows to cycle matches. Press Esc to clear or reset.</div>
          </div>

          <!-- BOM Upload panel -->
          <div class="panel">
            <div class="panel-title">Upload BOM (CSV)</div>
            <div id="bom-drop" class="bom-drop" tabindex="0" aria-label="BOM CSV drop area">
              <div class="bom-drop-inner">
                <div class="bom-drop-icon">ðŸ“„</div>
                <div class="bom-drop-text">Drag & drop a .csv file here</div>
                <div class="bom-drop-or">or</div>
                <div class="bom-drop-actions">
                  <button id="bom-browse" class="btn mini" type="button">Choose file</button>
                </div>
              </div>
              <input id="bom-input" type="file" accept=".csv,text/csv" hidden />
            </div>
            <div id="bom-error" class="panel-error" role="status" aria-live="polite"></div>
          </div>
        </aside>

        <section class="content">
          <!-- Horizontal tree wrapper -->
          <div id="tree-wrapper" class="tree-wrapper">
            <div id="tree-columns" class="tree-columns"></div>
            <svg id="tree-connections" class="tree-connections"></svg>
          </div>
        </section>
      </div>

    </div>
  </main>
  <footer class="cat-footer"><div class="cat-wrap">Data referenced locally by Raspberry Pi</div></footer>
  <script src="{{ url_for('static', filename='catalog/dendrogram-catalog.js') }}"></script>
</body>
</html>